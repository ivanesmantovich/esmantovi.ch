---
import { getCollection } from "astro:content";
import Note from "../components/Note.astro";

const notes = await getCollection("notes");

function formatDate(date: string) {
  const noteDate = new Date(date);
  const today = new Date();
  const yesterday = new Date(today);
  yesterday.setDate(yesterday.getDate() - 1);

  if (noteDate.toDateString() === today.toDateString()) {
    return "Today";
  }
  if (noteDate.toDateString() === yesterday.toDateString()) {
    return "Yesterday";
  }
  return date.replace(/-/g, ".");
}
---

<main class="home-page" transition:persist="home" transition:persist-props>
  <p class="message">Trust the Process & Love Yourself</p>

  <section>
    <h2>Notes</h2>
    <div class="grid">
      {
        notes.map((note) => {
          return (
            <Note
              title={note.data.title}
              text={note.data.preview}
              date={formatDate(note.data.date)}
              id={note.id}
            />
          );
        })
      }
    </div>
  </section>

  <section>
    <h2>Lab</h2>
    <div>ðŸš§ðŸš§ðŸš§</div>
  </section>

  <section>
    <h2>Resume</h2>
    <div>ðŸš§ðŸš§ðŸš§</div>
  </section>

  <section>
    <h2>Lorem</h2>
    <p>
      But I must explain to you how all this mistaken idea of denouncing
      pleasure and praising pain was born and I will give you a complete account
      of the system, and expound the actual teachings of the great explorer of
      the truth, the master-builder of human happiness. No one rejects,
      dislikes, or avoids pleasure itself, because it is pleasure, but because
      those who do not know how to pursue pleasure rationally encounter
      consequences that are extremely painful. Nor again is there anyone who
      loves or pursues or desires to obtain pain of itself, because it is pain,
      but because occasionally circumstances occur in which toil and pain can
      procure him some great pleasure. To take a trivial example, which of us
      ever undertakes laborious physical exercise, except to obtain some
      advantage from it? But who has any right to find fault with a man who
      chooses to enjoy a pleasure that has no annoying consequences, or one who
      avoids a pain that produces no resultant pleasure?
    </p>
    <h3>Ipsum</h3>
    <p>
      But I must explain to you how all this mistaken idea of denouncing
      pleasure and praising pain was born and I will give you a complete account
      of the system, and expound the actual teachings of the great explorer of
      the truth, the master-builder of human happiness. No one rejects,
      dislikes, or avoids pleasure itself, because it is pleasure, but because
      those who do not know how to pursue pleasure rationally encounter
      consequences that are extremely painful. Nor again is there anyone who
      loves or pursues or desires to obtain pain of itself, because it is pain,
      but because occasionally circumstances occur in which toil and pain can
      procure him some great pleasure. To take a trivial example, which of us
      ever undertakes laborious physical exercise, except to obtain some
      advantage from it? But who has any right to find fault with a man who
      chooses to enjoy a pleasure that has no annoying consequences, or one who
      avoids a pain that produces no resultant pleasure?
    </p>
    <h3>Ipsum</h3>
    <p>
      But I must explain to you how all this mistaken idea of denouncing
      pleasure and praising pain was born and I will give you a complete account
      of the system, and expound the actual teachings of the great explorer of
      the truth, the master-builder of human happiness. No one rejects,
      dislikes, or avoids pleasure itself, because it is pleasure, but because
      those who do not know how to pursue pleasure rationally encounter
      consequences that are extremely painful. Nor again is there anyone who
      loves or pursues or desires to obtain pain of itself, because it is pain,
      but because occasionally circumstances occur in which toil and pain can
      procure him some great pleasure. To take a trivial example, which of us
      ever undertakes laborious physical exercise, except to obtain some
      advantage from it? But who has any right to find fault with a man who
      chooses to enjoy a pleasure that has no annoying consequences, or one who
      avoids a pain that produces no resultant pleasure?
    </p>
    <h3>Ipsum</h3>
    <p>
      But I must explain to you how all this mistaken idea of denouncing
      pleasure and praising pain was born and I will give you a complete account
      of the system, and expound the actual teachings of the great explorer of
      the truth, the master-builder of human happiness. No one rejects,
      dislikes, or avoids pleasure itself, because it is pleasure, but because
      those who do not know how to pursue pleasure rationally encounter
      consequences that are extremely painful. Nor again is there anyone who
      loves or pursues or desires to obtain pain of itself, because it is pain,
      but because occasionally circumstances occur in which toil and pain can
      procure him some great pleasure. To take a trivial example, which of us
      ever undertakes laborious physical exercise, except to obtain some
      advantage from it? But who has any right to find fault with a man who
      chooses to enjoy a pleasure that has no annoying consequences, or one who
      avoids a pain that produces no resultant pleasure?
    </p>
  </section>
</main>

<script>
  // Save scroll position before navigation
  document.addEventListener("astro:before-preparation", () => {
    sessionStorage.setItem("homeScrollPosition", window.scrollY.toString());
  });

  // Restore scroll position after navigation
  document.addEventListener("astro:after-swap", () => {
    const savedPosition = sessionStorage.getItem("homeScrollPosition");
    if (savedPosition) {
      window.scrollTo({ top: parseInt(savedPosition), behavior: "instant" });
    }
  });
</script>

<style>
  .message {
    width: fit-content;
    margin: 2.5em auto 0;
    color: #6e6e73;
    user-select: none;
    cursor: default;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    font-size: 0.9em;
    font-weight: 600;
    animation: fadeOut 0.5s linear forwards;
    animation-play-state: paused;
  }

  .message:hover {
    animation-play-state: running;
  }

  @keyframes fadeOut {
    to {
      opacity: 0;
    }
  }

  h3 {
    margin-top: 2.5em;
    margin-bottom: 0.8em;
    font-size: 1.5em;
  }
</style>
