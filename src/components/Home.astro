---
import { getCollection } from 'astro:content'
import Note from '../components/Note.astro'
import { formatDate } from '../utils/date'
import Experiment from './Experiment.astro'
import Forward from '../assets/Forward.svg'
const notes = await getCollection('notes')
---

<main class="home-page">
  <p class="message">Trust the Process & Love Yourself</p>

  <section>
    <h2>About</h2>
    <p>
      But I must explain to you how all this mistaken idea of denouncing pleasure and praising pain
      was born and I will give you a complete account of the system, and expound the actual
      teachings of the great explorer of the truth, the master-builder of human happiness. No one
      rejects, dislikes, or avoids pleasure itself, because it is pleasure, but because those who do
      not know how to pursue pleasure rationally encounter consequences that are extremely painful.
      Nor again is there anyone who loves or pursues or desires to obtain pain of itself, because it
      is pain, but because occasionally circumstances occur in which toil and pain can procure him
      some great pleasure. To take a trivial example, which of us ever undertakes laborious physical
      exercise, except to obtain some advantage from it? But who has any right to find fault with a
      man who chooses to enjoy a pleasure that has no annoying consequences, or one who avoids a
      pain that produces no resultant pleasure?
    </p>
  </section>

  <section>
    <a href="/notes" class="clickable-header category-header">
      <h2>Days</h2>
      <Forward />
    </a>
    <div class="grid">
      {
        notes.map((note) => {
          return (
            <Note
              title={note.data.title}
              text={note.data.preview}
              date={formatDate(note.data.date)}
              id={note.id}
            />
          )
        })
      }
    </div>
    <a href="/notes" class="view-link">View all Notes</a>
  </section>

  <section>
    <a href="/experiments" class="clickable-header category-header">
      <h2>Experiments</h2>
      <Forward />
    </a>
    <div class="grid">
      <Experiment title="Experiment 1" />
      <Experiment title="Experiment 2" />
      <Experiment title="Experiment 3 but it has a very long and awesome title" />
      <Experiment title="Experiment 4" />
      <Experiment title="Experiment 5" />
      <Experiment title="Experiment 6" />
    </div>
    <a href="/experiments" class="view-link">View all Experiments</a>
  </section>

  <section>
    <h2>Resume</h2>
    <iframe id="resumeFrame" src="/resume-v1.pdf#toolbar=0&navpanes=0" frameborder="0"></iframe>
    <p id="mobileResumePlaceholder">Inline PDFs are not supported on mobile.</p>
    <a href="/resume-v1.pdf" class="view-link">View Resume PDF</a>
  </section>

  <div class="space"></div>
</main>

<script>
  // Save scroll position before navigation
  document.addEventListener('astro:before-preparation', () => {
    sessionStorage.setItem('homeScrollPosition', window.scrollY.toString())
  })

  // Restore scroll position after navigation
  document.addEventListener('astro:after-swap', () => {
    const savedPosition = sessionStorage.getItem('homeScrollPosition')
    if (savedPosition) {
      window.scrollTo({ top: parseInt(savedPosition), behavior: 'instant' })
    }
  })
</script>

<style>
  .view-link {
    display: inline-block;

    margin-top: 0.5em;
    margin-left: -1em;
    padding: 1em;

    font-size: 14px;
    font-weight: 500;
    color: #3872e9;
    text-decoration: none;
  }

  .message {
    cursor: default;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;

    width: fit-content;
    margin: 2.5em auto 0;

    font-size: 0.9em;
    font-weight: 600;
    color: #6e6e73;

    animation: fadeOut 0.5s linear forwards;
    animation-play-state: paused;
  }

  .message:hover {
    animation-play-state: running;
  }

  #resumeFrame {
    display: block;
    aspect-ratio: 1 / 1.414;
    width: 80%;
    border: 2px solid #d5d5d5;
  }

  #mobileResumePlaceholder {
    display: none;
  }

  .category-header {
    display: flex;
    gap: 0.5em;
    align-items: end;

    width: fit-content;

    color: unset;
    text-decoration: none;

    h2 {
      margin: 0;
    }

    svg {
      box-sizing: content-box;
      width: 20px;
      height: 20px;
      padding-bottom: 5px;

      opacity: 0.5;
    }
  }

  h3 {
    margin-top: 2.5em;
    margin-bottom: 0.8em;
    font-size: 1.5em;
  }

  p {
    line-height: 1.5;
    color: grey;
  }

  .space {
    height: 50vh;
  }

  @media (width <= 734px) {
    #resumeFrame {
      display: none;
    }

    #mobileResumePlaceholder {
      display: block;
    }
  }

  @keyframes fadeOut {
    to {
      opacity: 0;
    }
  }
</style>
